<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home Resources File - Access Required</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f8f8; color: #333; }
    nav { background: #eee; padding: 10px; text-align: center; }
    nav a { margin: 0 15px; text-decoration: none; color: #0066cc; }
    .container { max-width: 900px; margin: 20px auto; padding: 20px; background: white; border: 1px solid #ddd; }
    #login-form { max-width: 400px; margin: 100px auto; text-align: center; }
    #main-content, #staff-panel { display: none; }
    .section { margin: 20px 0; }
    .brand { cursor: pointer; padding: 10px; background: #f0f0f0; margin: 5px; }
    .strike-warning { background: #ffdddd; color: red; padding: 15px; margin: 10px 0; border: 2px solid red; display: none; }
    footer { text-align: center; margin-top: 50px; font-size: 12px; color: #777; }
    footer a { color: #999; margin: 0 10px; text-decoration: none; }
    .hidden-page { display: none; }
    button.edit-btn { background: #4CAF50; color: white; border: none; padding: 5px 10px; cursor: pointer; }
  </style>

  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="login-form">
  <h2>Home Resources File</h2>
  <p>Enter your credentials to access learning tools.</p>
  <input type="email" id="email" placeholder="Email / Username" required><br><br>
  <input type="password" id="password" placeholder="Password" required><br><br>
  <button onclick="login()">Login</button>
  <p id="error-msg" style="color:red;"></p>
</div>

<div id="main-content" class="container">
  <div class="strike-warning" id="strike-warning">
    <strong>WARNING:</strong> You have strikes on your account. Be careful or access may be revoked.
  </div>

  <nav>
    <a href="#" onclick="showSection('home')">Home</a>
    <a href="#" onclick="showSection('resources')">Study Resources</a>
    <a href="#" onclick="showSection('utilities')">Utilities</a>
    <a href="#" onclick="showSection('chat')">Chat</a>
    <a href="#" onclick="showSection('staff-list')">Staff List</a>
    <a href="#" onclick="showSection('calendar')">District Calendar</a>
    <a href="#" id="staff-link" style="display:none;" onclick="showSection('staff')">Staff Panel</a>
  </nav>

  <div id="home" class="section">
    <h1>Welcome to Home Resources File</h1>
    <p>Access interactive learning tools and resources. For authorized users only.</p>
  </div>

  <div id="resources" class="section" style="display:none;">
    <h2>Study Resources</h2>
    <div id="brands-list"></div>
    <div id="brand-subpage" style="display:none;">
      <button onclick="backToResources()">Back</button>
      <h3 id="brand-title"></h3>
      <div id="brand-links"></div>
    </div>
  </div>

  <div id="utilities" class="section" style="display:none;">
    <h2>Utilities</h2>
    <div id="utilities-list"></div>
  </div>

  <div id="chat" class="section" style="display:none;">
    <h2>Chat</h2>
    <div id="member-chat">
      <h3>Member Chat</h3>
      <div id="member-messages"></div>
      <input id="member-msg-input" placeholder="Type message...">
      <button onclick="sendMessage('member')">Send</button>
    </div>
    <div id="staff-chat" style="display:none;">
      <h3>Staff Chat</h3>
      <div id="staff-messages"></div>
      <input id="staff-msg-input" placeholder="Type message...">
      <button onclick="sendMessage('staff')">Send</button>
    </div>
  </div>

  <div id="staff-list" class="section" style="display:none;">
    <h2>Staff List</h2>
    <div id="staff-members"></div>
  </div>

  

  <div id="staff" class="section" style="display:none;">
    <h2>Staff Panel</h2>
    <p>Logs, popular list, user management coming soon...</p>
    <!-- Add more admin tools here later -->
  </div>

  <!-- Hidden Pages -->
  <div id="updates" class="hidden-page section">
    <h2>Version Updates</h2>
    <p>v1.0 - Initial launch (Feb 2026)</p>
  </div>
  <div id="announcements" class="hidden-page section">
    <h2>Announcements</h2>
    <p>No new announcements.</p>
  </div>
  <div id="terms" class="hidden-page section">
    <h2>Terms of Service</h2>
    <p>For educational use only. No sharing outside group.</p>
  </div>
  <div id="copyright" class="hidden-page section">
    <h2>Copyright Notice</h2>
    <p>Â© 2026 Personal Resources. All rights reserved.</p>
  </div>
  <div id="privacy" class="hidden-page section">
    <h2>Privacy Policy</h2>
    <p>Data handled securely via Firebase. No external sharing.</p>
  </div>

  <footer>
    <a href="#" onclick="showHidden('updates')">Version Updates</a> |
    <a href="#" onclick="showHidden('announcements')">Announcements</a> |
    <a href="#" onclick="showHidden('terms')">Terms of Service</a> |
    <a href="#" onclick="showHidden('copyright')">Copyright</a> |
    <a href="#" onclick="showHidden('privacy')">Privacy Policy</a>
  </footer>
</div>

<script>
  // Your Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCBj78TuU8hviaYMILXkXIzNtU8yIgk39c",
    authDomain: "learning-resources-2026.firebaseapp.com",
    projectId: "learning-resources-2026",
    storageBucket: "learning-resources-2026.firebasestorage.app",
    messagingSenderId: "67701812368",
    appId: "1:67701812368:web:bc5f0a9033e1cb6b347c15",
    measurementId: "G-HJFZ5CLEBR"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;
  let userRole = 'user'; // default
  let userStrikes = 0;

  // Login function
  function login() {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, pass)
      .then(userCredential => {
        currentUser = userCredential.user;
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        loadUserData();
      })
      .catch(error => {
        document.getElementById('error-msg').innerText = error.message;
      });
  }

  // Load user role, strikes, etc. from Firestore
  function loadUserData() {
    db.collection('users').doc(currentUser.uid).get().then(doc => {
      if (doc.exists) {
        const data = doc.data();
        userRole = data.role || 'user';
        userStrikes = data.strikes || 0;
        if (userStrikes > 0) {
          document.getElementById('strike-warning').style.display = 'block';
          document.getElementById('strike-warning').innerText = `WARNING: You have ${userStrikes} strike(s). Be careful.`;
        }
        if (['admin', 'co-admin', 'manager'].includes(userRole)) {
          document.getElementById('staff-link').style.display = 'inline';
        }
        if (userRole === 'staff' || userRole === 'contributor') {
          document.getElementById('staff-chat').style.display = 'block';
        }
        loadContent();
      } else {
        // Create new user doc if not exists
        db.collection('users').doc(currentUser.uid).set({
          email: currentUser.email,
          role: 'user',
          strikes: 0
        });
      }
    });
  }

  // Load main content (brands, utilities, etc.)
  function loadContent() {
    showSection('home');

    // Example: Load brands from Firestore
    db.collection('brands').get().then(snapshot => {
      const list = document.getElementById('brands-list');
      list.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.className = 'brand';
        div.innerText = data.name;
        div.onclick = () => loadBrandSubpage(doc.id, data);
        list.appendChild(div);
      });
    });

    // Utilities example
    db.collection('utilities').get().then(snapshot => {
      const list = document.getElementById('utilities-list');
      list.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const a = document.createElement('a');
        a.href = data.url;
        a.target = '_blank';
        a.innerText = data.name;
        a.onclick = () => trackClick('utility', doc.id);
        list.appendChild(a);
        list.appendChild(document.createElement('br'));
      });
    });

    // Load chats, staff list, etc. (expand as needed)
  }

  function loadBrandSubpage(id, data) {
    document.getElementById('resources').style.display = 'block';
    document.getElementById('brands-list').style.display = 'none';
    document.getElementById('brand-subpage').style.display = 'block';
    document.getElementById('brand-title').innerText = data.name;

    const linksDiv = document.getElementById('brand-links');
    linksDiv.innerHTML = '';
    data.links.forEach(link => {
      const a = document.createElement('a');
      a.href = link.url;
      a.target = '_blank';
      a.innerText = link.name;
      a.onclick = () => trackClick('brand', id + '-' + link.name);
      linksDiv.appendChild(a);
      linksDiv.appendChild(document.createElement('br'));
    });
  }

  function backToResources() {
    document.getElementById('brands-list').style.display = 'block';
    document.getElementById('brand-subpage').style.display = 'none';
  }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  }

  function showHidden(id) {
    document.querySelectorAll('.hidden-page').forEach(p => p.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  }

  function trackClick(type, id) {
    db.collection('clicks').add({
      type,
      id,
      user: currentUser.email,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }

  function sendMessage(chatType) {
    const input = document.getElementById(chatType + '-msg-input');
    const msg = input.value.trim();
    if (!msg) return;
    db.collection(chatType + 'Chat').add({
      text: msg,
      user: currentUser.email,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    input.value = '';
  }

  // Real-time chat listener example
  ['member', 'staff'].forEach(type => {
    db.collection(type + 'Chat').orderBy('timestamp').onSnapshot(snapshot => {
      const div = document.getElementById(type + '-messages');
      div.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        div.innerHTML += `<p><strong>${data.user}:</strong> ${data.text}</p>`;
      });
      div.scrollTop = div.scrollHeight;
    });
  });

  // Logout example (add button if needed)
  // auth.signOut().then(() => location.reload());

// Load calendar events from Firestore
function loadCalendar() {
  db.collection('events')
    .orderBy('date')
    .get()
    .then(snapshot => {
      const container = document.getElementById('calendar-events');
      container.innerHTML = '';

      if (snapshot.empty) {
        container.innerHTML = '<p style="color:#777;">No events scheduled yet.</p>';
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const eventDiv = document.createElement('div');
        eventDiv.style.margin = '12px 0';
        eventDiv.style.padding = '10px';
        eventDiv.style.borderLeft = '4px solid #0066cc';
        eventDiv.innerHTML = `
          <strong>${data.date || 'Date TBD'}</strong><br>
          <span style="font-weight:bold;">${data.title || 'Untitled Event'}</span><br>
          ${data.description || ''}<br>
          ${data.location ? `<small>Location: ${data.location}</small>` : ''}
        `;
        container.appendChild(eventDiv);
      });
    })
    .catch(err => {
      console.error("Calendar load error:", err);
      document.getElementById('calendar-events').innerHTML = '<p style="color:red;">Error loading calendar.</p>';
    });
}

// Show add event button for admins/co-admins
function showAddEventButton() {
  const btn = document.getElementById('add-event-btn');
  if (['admin', 'co-admin'].includes(userRole)) {
    btn.style.display = 'inline-block';
    btn.onclick = addEventPrompt;
  }
}

// Simple prompt-based event adder (expand to modal later if you want)
function addEventPrompt() {
  const title = prompt("Event Title:");
  if (!title) return;

  const date = prompt("Date (YYYY-MM-DD):");
  if (!date) return;

  const desc = prompt("Description (optional):") || "";
  const loc = prompt("Location (optional):") || "";

  db.collection('events').add({
    title,
    date,
    description: desc,
    location: loc,
    createdBy: currentUser.email,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    alert("Event added!");
    loadCalendar(); // refresh list
  })
  .catch(err => {
    alert("Error adding event: " + err.message);
  });
}

</script>
